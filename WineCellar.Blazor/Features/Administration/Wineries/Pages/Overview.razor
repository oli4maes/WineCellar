@page "/Administration/Wineries"

<PageTitle>Kave - Administration - Wineries</PageTitle>

<AuthorizeView Policy="AdminRole">
    <Authorized>
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h4">Wineries</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudFab StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" OnClick="AddWinery" Size="Size.Small"/>
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                @if (_wineries.Any())
                {
                    <MudDataGrid T="WineryDto"
                                 Items="@_wineries"
                                 SortMode="SortMode.Multiple"
                                 QuickFilter="QuickFilter"
                                 Hideable=true>
                        <ToolBarContent>
                            <MudText Typo="Typo.h6">Wineries</MudText>
                            <MudSpacer/>
                            <MudTextField @bind-Value="_searchString"
                                          Placeholder="Search"
                                          Adornment="Adornment.Start"
                                          Immediate="true"
                                          AdornmentIcon="@Icons.Material.Filled.Search"
                                          IconSize="Size.Medium"
                                          Class="mt-0">
                            </MudTextField>
                        </ToolBarContent>
                        <Columns>
                            <PropertyColumn Property="x => x.Name" Title="Name" Sortable="true" Filterable="true"/>
                            <PropertyColumn Property="x => x.CountryName" Title="Country" Sortable="true" Filterable="true"/>
                            <TemplateColumn>
                                <CellTemplate Context="WineryEditContext">
                                    @{
                                        var winery = WineryEditContext.Item;
                                    }
                                    <MudToggleIconButton Toggled="@winery.IsSpotlit"
                                                         ToggledChanged="() => ToggleIsSpotlit(winery)"
                                                         Size="Size.Small"
                                                         Icon="@Icons.Material.Outlined.ExploreOff"
                                                         Color="Color.Error"
                                                         Title="Not spotlit"
                                                         ToggledSize="Size.Small"
                                                         ToggledIcon="@Icons.Material.Outlined.Explore"
                                                         ToggledColor="Color.Success"
                                                         ToggledTitle="Spotlit"/>

                                    <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Edit" Color="Color.Info" @onclick="() => OpenWinery(winery)"/>
                                    <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Delete" Color="Color.Error" @onclick="() => DeleteWinery(winery)"/>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                        <PagerContent>
                            <MudDataGridPager T="WineryDto"/>
                        </PagerContent>
                    </MudDataGrid>
                }
            </MudCardContent>
        </MudCard>
    </Authorized>
</AuthorizeView>